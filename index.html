<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Pic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-color: #00BCD4;
            --primary-text-color: #121212;
            --secondary-color: #80CBC4;
            --dark-bg-color: #121212;
            --card-bg-color: #1F1F1F;
            --text-color: #E0E0E0;
            --text-muted-color: #A0A0A0;
            --border-color: #333333;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg-color);
            color: var(--text-color);
        }
        #canvas-container {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--card-bg-color);
            max-width: 100%;
            height: auto;
            min-height: 400px;
            overflow: hidden;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.6);
        }
        #imageCanvas {
            max-width: 100%;
            max-height: 80vh;
            display: block;
            border-radius: 0.75rem;
            transition: filter 0.3s ease;
        }
        #fileInput {
            display: none;
        }
        #fileLabel {
            cursor: pointer;
            display: block;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
            height: 1rem;
        }
        input[type="range"]::-webkit-slider-runnable-track {
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
        }
        input[type="range"]::-moz-range-track {
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            margin-top: -6px;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--primary-color);
            box-shadow: 0 0 0 4px var(--card-bg-color);
            transition: background 0.15s ease-in-out;
        }
        input[type="range"]::-moz-range-thumb {
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--primary-color);
            border: none;
            box-shadow: 0 0 0 4px var(--card-bg-color);
            transition: background 0.15s ease-in-out;
        }
        input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--text-muted-color);
            border-radius: 4px;
            cursor: pointer;
            background-color: transparent;
            transition: background-color 0.15s, border-color 0.15s;
            position: relative;
            vertical-align: middle;
            flex-shrink: 0;
        }
        input[type="checkbox"]:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        input[type="checkbox"]:checked::after {
            content: '✓';
            color: var(--primary-text-color);
            font-size: 14px;
            line-height: 1;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #cropSelection {
            position: absolute;
            border: 2px dashed var(--primary-color);
            background-color: rgba(0, 188, 212, 0.2);
            cursor: move;
            display: none;
            z-index: 10;
        }
        .vignette-effect::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 1.5rem;
            box-shadow: inset 0 0 150px rgba(0, 0, 0, 0.9);
            pointer-events: none;
            z-index: 5;
        }
        #centerUploadArea {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            width: 80%;
            max-width: 300px;
            min-height: 180px;
            border: 2px dashed var(--border-color);
            border-radius: 1rem;
            transition: background-color 0.3s ease;
            padding: 1rem;
            text-align: center;
        }
        #centerUploadArea:hover {
            background-color: rgba(0, 188, 212, 0.1);
        }
        #centerUploadArea.hidden {
            display: none;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': 'var(--primary-color)',
                        'primary-text': 'var(--primary-text-color)',
                        'secondary': 'var(--secondary-color)',
                        'dark-bg': 'var(--dark-bg-color)',
                        'card-bg': 'var(--card-bg-color)',
                        'text-color': 'var(--text-color)',
                        'text-muted': 'var(--text-muted-color)',
                        'border-color': 'var(--border-color)',
                    }
                }
            }
        }
    </script>
</head>
<body class="p-4 sm:p-8 min-h-screen">
    <div id="app" class="max-w-7xl mx-auto">
        <header class="mb-10 p-4 bg-card-bg rounded-xl shadow-lg border-b border-border-color">
            <nav class="flex items-center h-10">
                <h1 class="text-3xl font-extrabold text-primary">Edit Pic</h1>
            </nav>
        </header>
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 bg-card-bg p-6 rounded-3xl shadow-2xl h-full space-y-8">
                <h2 class="text-xl font-bold text-text-color">Ajustes Básicos</h2>
                <div class="space-y-6" id="controls">
                    <div class="control-group">
                        <label for="exposure" class="block text-sm font-medium text-text-muted mb-2">Exposição: <span id="exposureValue">100</span>%</label>
                        <input type="range" id="exposure" min="0" max="200" value="100" class="w-full h-2 bg-border-color rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="control-group">
                        <label for="contrast" class="block text-sm font-medium text-text-muted mb-2">Contraste: <span id="contrastValue">100</span>%</label>
                        <input type="range" id="contrast" min="0" max="200" value="100" class="w-full h-2 bg-border-color rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="control-group">
                        <label for="saturation" class="block text-sm font-medium text-text-muted mb-2">Saturação: <span id="saturationValue">100</span>%</label>
                        <input type="range" id="saturation" min="0" max="200" value="100" class="w-full h-2 bg-border-color rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="control-group">
                        <label for="blur" class="block text-sm font-medium text-text-muted mb-2">Desfoque: <span id="blurValue">0.0</span>px</label>
                        <input type="range" id="blur" min="0" max="10" step="0.1" value="0" class="w-full h-2 bg-border-color rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>
                <h2 class="text-xl font-bold text-text-color pt-8 border-t border-border-color">Efeitos</h2>
                <div class="space-y-4">
                    <div class="flex items-center justify-between py-2 rounded-lg hover:bg-card-bg/50 transition duration-100">
                        <label for="grayscale" class="text-base font-medium text-text-color w-full cursor-pointer">Tons de Cinza</label>
                        <input type="checkbox" id="grayscale">
                    </div>
                    <div class="flex items-center justify-between py-2 rounded-lg hover:bg-card-bg/50 transition duration-100">
                        <label for="sepia" class="text-base font-medium text-text-color w-full cursor-pointer">Sépia</label>
                        <input type="checkbox" id="sepia">
                    </div>
                    <div class="flex items-center justify-between py-2 rounded-lg hover:bg-card-bg/50 transition duration-100">
                        <label for="vignette" class="text-base font-medium text-text-color w-full cursor-pointer">Vinheta</label>
                        <input type="checkbox" id="vignette">
                    </div>
                </div>
                <h2 class="text-xl font-bold text-text-color pt-8 border-t border-border-color">Transformações</h2>
                <div class="space-y-4">
                    <button id="cropButton" class="w-full text-left py-2 px-4 rounded-lg hover:bg-card-bg/50 transition duration-100 disabled:opacity-50" disabled>
                        <span class="text-base font-medium text-text-color">Cortar Imagem</span>
                    </button>
                    <button id="rotateButton" class="w-full text-left py-2 px-4 rounded-lg hover:bg-card-bg/50 transition duration-100 disabled:opacity-50" disabled>
                        <span class="text-base font-medium text-text-color">Rotacionar 90°</span>
                    </button>
                    <button id="flipHorizontalButton" class="w-full text-left py-2 px-4 rounded-lg hover:bg-card-bg/50 transition duration-100 disabled:opacity-50" disabled>
                        <span class="text-base font-medium text-text-color">Espelhar Horizontal</span>
                    </button>
                    <button id="flipVerticalButton" class="w-full text-left py-2 px-4 rounded-lg hover:bg-card-bg/50 transition duration-100 disabled:opacity-50" disabled>
                        <span class="text-base font-medium text-text-color">Espelhar Vertical</span>
                    </button>
                </div>
            </div>
            <div class="lg:col-span-2">
                <div class="bg-card-bg p-6 rounded-3xl shadow-2xl h-full flex flex-col items-center space-y-4">
                    <input type="file" id="fileInput" accept="image/*">
                    <div id="canvas-container" class="w-full">
                        <canvas id="imageCanvas" class="hidden"></canvas>
                        <div id="cropSelection"></div>
                        <label id="centerUploadArea" for="fileInput" class="text-text-color hover:bg-primary/10 transition duration-200">
                            <svg class="w-12 h-12 text-primary mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                            <span class="font-bold text-lg text-primary">Carregar Imagem</span>
                            <span class="text-sm text-text-muted mt-1">Clique ou arraste e solte aqui</span>
                            <div class="mt-4 pt-4 border-t border-dashed border-border-color w-full text-center">
                                <span class="text-sm text-text-muted">Nenhuma imagem carregada.</span>
                            </div>
                        </label>
                    </div>
                    <button id="downloadButton" class="w-full max-w-sm bg-secondary hover:opacity-90 transition duration-200 py-3 rounded-full font-bold shadow-lg mt-4 disabled:opacity-50 text-primary-text" disabled>
                        Baixar Imagem Editada
                    </button>
                    <button id="changeImageButton" class="w-full max-w-sm bg-border-color hover:bg-border-color/80 transition duration-200 py-3 rounded-full font-bold shadow-lg disabled:opacity-50 text-text-color" style="display: none;">
                        Trocar Imagem
                    </button>
                    <p id="statusMessage" class="text-center text-sm text-text-muted mt-2 h-5"></p>
                </div>
            </div>
        </main>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('fileInput');
            const canvas = document.getElementById('imageCanvas');
            const ctx = canvas.getContext('2d');
            const downloadButton = document.getElementById('downloadButton');
            const changeImageButton = document.getElementById('changeImageButton');
            const statusMessage = document.getElementById('statusMessage');
            const canvasContainer = document.getElementById('canvas-container');
            const centerUploadArea = document.getElementById('centerUploadArea');
            const cropButton = document.getElementById('cropButton');
            const rotateButton = document.getElementById('rotateButton');
            const flipHorizontalButton = document.getElementById('flipHorizontalButton');
            const flipVerticalButton = document.getElementById('flipVerticalButton');
            const cropSelection = document.getElementById('cropSelection');
            let currentImage = null;
            let rotationAngle = 0;
            let flipH = 1;
            let flipV = 1;
            const filterSettings = { exposure: 100, contrast: 100, saturation: 100, blur: 0, grayscale: false, sepia: false, vignette: false };
            let isCropping = false;
            let cropStartX, cropStartY;
            let cropRect = { x: 0, y: 0, width: 0, height: 0 };
            function buildFilterString() {
                let filter = `brightness(${filterSettings.exposure}%) contrast(${filterSettings.contrast}%) saturation(${filterSettings.saturation}%)`;
                if (filterSettings.grayscale) {
                    filter += ' grayscale(100%)';
                }
                if (filterSettings.sepia) {
                    filter += ' sepia(100%)';
                }
                if (filterSettings.blur > 0) {
                    filter += ` blur(${filterSettings.blur}px)`;
                }
                return filter;
            }
            function applyCssFilters() {
                if (currentImage) {
                    const filter = buildFilterString();
                    canvas.style.filter = filter;
                    if (filterSettings.vignette) {
                        canvasContainer.classList.add('vignette-effect');
                    } else {
                        canvasContainer.classList.remove('vignette-effect');
                    }
                }
            }
            function drawImageOnCanvas() {
                if (!currentImage) return;
                const imgWidth = currentImage.naturalWidth || currentImage.width;
                const imgHeight = currentImage.naturalHeight || currentImage.height;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save();
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.scale(flipH, flipV);
                ctx.rotate(rotationAngle * Math.PI / 180);
                ctx.drawImage(currentImage, -imgWidth / 2, -imgHeight / 2, imgWidth, imgHeight);
                ctx.restore();
                applyCssFilters();
            }
            let statusTimeout;
            function updateStatus(message) {
                if (statusMessage) {
                    statusMessage.textContent = message;
                    clearTimeout(statusTimeout);
                    statusTimeout = setTimeout(() => {
                        if (statusMessage) statusMessage.textContent = '';
                    }, 3000);
                }
            }
            function toggleTransformationButtons(enabled) {
                if (rotateButton) rotateButton.disabled = !enabled;
                if (flipHorizontalButton) flipHorizontalButton.disabled = !enabled;
                if (flipVerticalButton) flipVerticalButton.disabled = !enabled;
                if (cropButton) cropButton.disabled = !enabled;
                if (downloadButton) downloadButton.disabled = !enabled;
                if (changeImageButton) changeImageButton.style.display = enabled ? 'block' : 'none';
            }
            if (fileInput) {
                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    function resetEditorState() {
                        if (document.getElementById('exposure')) document.getElementById('exposure').value = 100;
                        if (document.getElementById('contrast')) document.getElementById('contrast').value = 100;
                        if (document.getElementById('saturation')) document.getElementById('saturation').value = 100;
                        if (document.getElementById('blur')) document.getElementById('blur').value = 0;
                        if (document.getElementById('grayscale')) document.getElementById('grayscale').checked = false;
                        if (document.getElementById('sepia')) document.getElementById('sepia').checked = false;
                        if (document.getElementById('vignette')) document.getElementById('vignette').checked = false;
                        Object.assign(filterSettings, { exposure: 100, contrast: 100, saturation: 100, blur: 0, grayscale: false, sepia: false, vignette: false });
                        canvas.style.filter = '';
                        canvasContainer.classList.remove('vignette-effect');
                        rotationAngle = 0;
                        flipH = 1;
                        flipV = 1;
                        isCropping = false;
                        cropSelection.style.display = 'none';
                        currentImage = null;
                        canvas.classList.add('hidden');
                        if (centerUploadArea) centerUploadArea.classList.remove('hidden');
                        toggleTransformationButtons(false);
                        updateStatus('');
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    }
                    if (currentImage) {
                         resetEditorState(); 
                    }
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const img = new Image();
                        img.onload = function() {
                            currentImage = img;
                            canvas.width = img.naturalWidth || img.width;
                            canvas.height = img.naturalHeight || img.height;
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                            applyCssFilters();
                            toggleTransformationButtons(true);
                            canvas.classList.remove('hidden');
                            if (centerUploadArea) centerUploadArea.classList.add('hidden');
                            updateStatus('Imagem carregada com sucesso.');
                        };
                        img.onerror = function() {
                            updateStatus('Erro ao carregar a imagem.');
                            toggleTransformationButtons(false);
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                });
            }
            if (changeImageButton) {
                changeImageButton.addEventListener('click', () => {
                    if (fileInput) fileInput.click();
                });
            }
            document.querySelectorAll('#controls input[type="range"]').forEach(slider => {
                if (slider) {
                    slider.addEventListener('input', (e) => {
                        const id = e.target.id;
                        let value = e.target.value;
                        if (id === 'blur') {
                            filterSettings[id] = parseFloat(value);
                            if (document.getElementById(`${id}Value`)) document.getElementById(`${id}Value`).textContent = parseFloat(value).toFixed(1);
                        } else {
                            filterSettings[id] = parseInt(value);
                            if (document.getElementById(`${id}Value`)) document.getElementById(`${id}Value`).textContent = value;
                        }
                        applyCssFilters();
                    });
                }
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (checkbox) {
                    checkbox.addEventListener('change', (e) => {
                        const id = e.target.id;
                        filterSettings[id] = e.target.checked;
                        applyCssFilters();
                    });
                }
            });
            function redrawImageWithTransformations() {
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                const imgWidth = currentImage.naturalWidth || currentImage.width;
                const imgHeight = currentImage.naturalHeight || currentImage.height;
                if (rotationAngle === 90 || rotationAngle === 270) {
                    tempCanvas.width = imgHeight;
                    tempCanvas.height = imgWidth;
                } else {
                    tempCanvas.width = imgWidth;
                    tempCanvas.height = imgHeight;
                }
                tempCtx.save();
                tempCtx.translate(tempCanvas.width / 2, tempCanvas.height / 2);
                tempCtx.scale(flipH, flipV);
                tempCtx.rotate(rotationAngle * Math.PI / 180);
                tempCtx.drawImage(currentImage, -imgWidth / 2, -imgHeight / 2, imgWidth, imgHeight);
                tempCtx.restore();
                const newImage = new Image();
                newImage.onload = () => {
                    currentImage = newImage;
                    canvas.width = currentImage.width;
                    canvas.height = currentImage.height;
                    drawImageOnCanvas();
                };
                newImage.src = tempCanvas.toDataURL();
            }
            if (rotateButton) {
                rotateButton.addEventListener('click', () => {
                    if (!currentImage) return;
                    rotationAngle = (rotationAngle + 90) % 360;
                    redrawImageWithTransformations();
                    updateStatus(`Imagem rotacionada para ${rotationAngle}°`);
                });
            }
            if (flipHorizontalButton) {
                flipHorizontalButton.addEventListener('click', () => {
                    if (!currentImage) return;
                    flipH *= -1;
                    redrawImageWithTransformations();
                    updateStatus(flipH === -1 ? 'Imagem espelhada horizontalmente' : 'Espelhamento horizontal removido');
                });
            }
            if (flipVerticalButton) {
                flipVerticalButton.addEventListener('click', () => {
                    if (!currentImage) return;
                    flipV *= -1;
                    redrawImageWithTransformations();
                    updateStatus(flipV === -1 ? 'Imagem espelhada verticalmente' : 'Espelhamento vertical removido');
                });
            }
            function applyCrop() {
                if (!currentImage || cropRect.width === 0 || cropRect.height === 0) {
                    updateStatus('Nenhuma área válida para corte selecionada.');
                    return;
                }
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = cropRect.width;
                tempCanvas.height = cropRect.height;
                tempCtx.drawImage(
                    currentImage,
                    cropRect.x, cropRect.y, cropRect.width, cropRect.height,
                    0, 0, cropRect.width, cropRect.height
                );
                const newImage = new Image();
                newImage.onload = () => {
                    currentImage = newImage;
                    canvas.width = currentImage.width;
                    canvas.height = currentImage.height;
                    drawImageOnCanvas();
                    updateStatus('Imagem cortada com sucesso.');
                    cropSelection.style.display = 'none';
                    isCropping = false;
                    canvas.style.cursor = 'default';
                };
                newImage.src = tempCanvas.toDataURL();
            }
            if (cropButton) {
                cropButton.addEventListener('click', () => {
                    if (!currentImage) return;
                    isCropping = !isCropping;
                    if (isCropping) {
                        updateStatus('Modo de corte ativado. Arraste para selecionar a área.');
                        cropSelection.style.display = 'block';
                        cropRect = { x: 0, y: 0, width: 0, height: 0 };
                        cropSelection.style.width = '0px';
                        cropSelection.style.height = '0px';
                        cropSelection.style.left = '0px';
                        cropSelection.style.top = '0px';
                        canvas.style.cursor = 'crosshair';
                    } else {
                        updateStatus('Modo de corte desativado.');
                        cropSelection.style.display = 'none';
                        canvas.style.cursor = 'default';
                        if (cropRect.width > 0 && cropRect.height > 0) {
                            applyCrop();
                        }
                    }
                });
            }
            let isDrawing = false;
            let startX, startY;
            if (canvasContainer) {
                canvasContainer.addEventListener('mousedown', (e) => {
                    if (!isCropping || !currentImage) return;
                    const rect = canvas.getBoundingClientRect();
                    const scaleX = canvas.width / rect.width;
                    const scaleY = canvas.height / rect.height;
                    startX = (e.clientX - rect.left) * scaleX;
                    startY = (e.clientY - rect.top) * scaleY;
                    isDrawing = true;
                    cropSelection.style.display = 'block';
                    cropSelection.style.left = `${e.clientX - rect.left}px`;
                    cropSelection.style.top = `${e.clientY - rect.top}px`;
                    cropSelection.style.width = '0px';
                    cropSelection.style.height = '0px';
                });
                canvasContainer.addEventListener('mousemove', (e) => {
                    if (!isCropping || !isDrawing || !currentImage) return;
                    const rect = canvas.getBoundingClientRect();
                    const scaleX = canvas.width / rect.width;
                    const scaleY = canvas.height / rect.height;
                    const currentX = (e.clientX - rect.left) * scaleX;
                    const currentY = (e.clientY - rect.top) * scaleY;
                    const width = currentX - startX;
                    const height = currentY - startY;
                    cropSelection.style.left = `${Math.min(startX, currentX) / scaleX}px`;
                    cropSelection.style.top = `${Math.min(startY, currentY) / scaleY}px`;
                    cropSelection.style.width = `${Math.abs(width) / scaleX}px`;
                    cropSelection.style.height = `${Math.abs(height) / scaleY}px`;
                    cropRect = {
                        x: Math.min(startX, currentX),
                        y: Math.min(startY, currentY),
                        width: Math.abs(width),
                        height: Math.abs(height)
                    };
                });
                canvasContainer.addEventListener('mouseup', () => {
                    if (!isCropping || !isDrawing) return;
                    isDrawing = false;
                    updateStatus('Área de corte selecionada. Clique em "Cortar Imagem" novamente para aplicar ou cancelar.');
                });
            }
            if (downloadButton) {
                downloadButton.addEventListener('click', () => {
                    if (!currentImage) {
                        updateStatus('Por favor, carregue uma imagem primeiro.');
                        return;
                    }
                    updateStatus('Download iniciado. (Nota: Os efeitos de filtro são aplicados via CSS e não são codificados no arquivo PNG resultante, devido à simplicidade do editor. Para filtros reais, seria necessária manipulação de pixel).');
                    try {
                        const link = document.createElement('a');
                        link.download = 'imagem-editada.png';
                        link.href = canvas.toDataURL('image/png');
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    } catch (error) {
                        console.error("Erro durante o download:", error);
                        updateStatus('Erro ao tentar baixar a imagem.');
                    }
                });
            }
            window.addEventListener('resize', () => {
                if (currentImage) {
                    drawImageOnCanvas();
                }
            });
        });
    </script>
</body>
</html>
